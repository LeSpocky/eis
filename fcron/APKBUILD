# Contributor:
# Maintainer: jens@eisfair.org
pkgname=fcron
pkgver=3.0.6
pkgrel=2
pkgdesc="cron scheduler"
url="http://fcron.free.fr"
arch="all"
license="GNU"
depends=""
depends_dev="perl"
makedepends="$depends_dev"
install="$pkgname.pre-install $pkgname.post-install $pkgname.pre-deinstall $pkgname.post-deinstall $pkgname.pre-upgrade $pkgname.post-upgrade"
subpackages=""
source="http://fcron.free.fr/archives/fcron-3.0.6.src.tar.gz
        ${pkgname}.initd
        systab.orig"

_builddir="$srcdir/${pkgname}-$pkgver"

prepare() {
	local i
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_builddir"
	./configure --prefix=/usr \
	--sysconfdir=/etc \
	--with-spooldir=/var/spool/fcron \
	--with-piddir=/run \
	--with-fifodir=/run \
	--enable-ipv6 \
	--with-username=cron \
	--with-groupname=cron \
	--with-selinux=no \
	--with-pam=no \
	--with-sysfcrontab=yes \
	--with-boot-install=no \
	|| return 1
	make || return 1
}

package() {
	cd "$_builddir"
	make -j1 DESTDIR="$pkgdir" install || return 1
	rm -rf ${pkgdir}/usr/share
	rm -rf ${pkgdir}/var/run
	strip -R .note -R .comment ${pkgdir}/usr/bin/*
	strip -R .note -R .comment ${pkgdir}/usr/sbin/*
	install -D -m755 ${srcdir}/${pkgname}.initd ${pkgdir}/etc/init.d/${pkgname} || return 1
	install -D -m640 ${srcdir}/systab.orig ${pkgdir}/var/spool/fcron/systab.orig || return 1
	mkdir -p ${pkgdir}/etc/cron/root || return 1
}

md5sums="69ebcb41921e2a282f41ebecb3a27053  fcron-3.0.6.src.tar.gz
4f517b2481c08f28922c1f74fe344c9e  fcron.initd
34bf916ff0f845960dce715f052bc48b  systab.orig"
sha256sums="9c36b1bc6c931ec8b4ef55fef569ba17004b32f3ae0a72e3cc4ec4d15bee30a1  fcron-3.0.6.src.tar.gz
1d90eba5941b697241964ca895e40026bce6710e73ccbdc51f306ed83c891bf8  fcron.initd
b1e164fea850d75a90052058d0b5b82463ac916fb9b8066315fddfd06465e01e  systab.orig"
sha512sums="53dfc2f57820392e4d32230d9abeaa3ec8a2c4aac6fc4888a266553806e7c31cecc655ff8cd5dbd635e40903cf649962e752e5ba6a5bd7728c79bc42771dfb99  fcron-3.0.6.src.tar.gz
d3ca9acdda8e58cd37915bad266a80e8cd84ed6721d658391b4bf8f0e74009c55e8ed4bb0c8cf68aeaa838b1eaf39ada404b6db3ccd9c76d059922d4b13d38de  fcron.initd
7d49d571fa5406babc2d80229ca263353b787e26f264063ad463ef6120dd3baa7035944f20b97daee6d8ba8ee80762fc5411df2b82504885001feb86db88492f  systab.orig"
