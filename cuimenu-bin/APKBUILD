# Contributor: Jens Vehlhaber <jens@eisfair.org>
# Maintainer: The eisfair team <team@eisfair.org>
pkgname=cuimenu-bin
pkgver=3.0.2
pkgrel=0
pkgdesc="Eisfair CUI basis menu - binary files"
url="http://www.eisfair.org"
arch="all"
license="GNU"
depends="libcui>=2.0.0"
_alpinerelease=`awk -F \. {'print $1$2'} /etc/alpine-release`
if [ "$_alpinerelease" -gt 31 ]
then
  depends_dev="coreutils libcui-dev>=2.0.0 ncurses-dev flex"
else
  depends_dev="coreutils libcui-dev>=2.0.0 ncurses-dev flex libiconv-dev"
fi

makedepends="$depends_dev"
install=""
subpackages=""
source=""

_builddir="$srcdir"

prepare() {
	local i
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
	cp -rf ${startdir}/source/* ${_builddir}/
}

build() {
	mkdir -p ${pkgdir}/var/install/bin
	cd ${_builddir}/ask.cui
	make -j1 -s || return 1
	echo ""
	cd ${_builddir}/edit-conf.cui
	make -j1 -s || return 1
	echo ""
	cd ${_builddir}/eischk
	make -j1 eischk || return 1
	echo ""
	cd ${_builddir}/list-files.cui
	make -j1 -s || return 1
	echo ""
	cd ${_builddir}/netcalc
	make -j1 -s || return 1
	echo ""
	cd ${_builddir}/shellrun.cui
	make -j1 -s || return 1
	echo ""
	cd ${_builddir}/show-doc.cui
	autoconf
	./configure --prefix=/var/install
	make -j1 -s || return 1
	echo ""
	cd ${_builddir}/show-menu.cui
	autoconf
	./configure --prefix=/var/install
	make -j1 -s || return 1
}

package() {
	mkdir -p ${pkgdir}/var/install/bin
	cd ${_builddir}/ask.cui
	make -j1 DESTDIR="$pkgdir" install || return 1
	cd ${_builddir}/edit-conf.cui
	make -j1 DESTDIR="$pkgdir" install || return 1
	cp ${_builddir}/eischk/eischk ${pkgdir}/var/install/bin/
	cd ${_builddir}/list-files.cui
	make -j1 DESTDIR="$pkgdir" install || return 1
	cp ${_builddir}/netcalc/netcalc ${pkgdir}/var/install/bin/
	cd ${_builddir}/shellrun.cui
	make -j1 DESTDIR="$pkgdir" install || return 1
	cd ${_builddir}/show-doc.cui
	make -j1 DESTDIR="$pkgdir" install || return 1
	cd ${_builddir}/show-menu.cui
	make -j1 DESTDIR="$pkgdir" install || return 1
}

