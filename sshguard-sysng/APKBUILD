# Contributor: Jens Vehlhaber jv <jens@eisfair.org>
# Maintainer: Jens Vehlhaber jv <jens@eisfair.org>
pkgname=sshguard-sysng
pkgver=1.5
pkgrel=2
pkgdesc="Log monitor that blocks with iptables on bad behaviour - for syslog-ng with postfix support"
url="http://www.sshguard.net/"
arch="all"
license="BSD"
depends="iptables"
depends_dev=""
makedepends="$depends_dev flex bison"
install=""
subpackages="$pkgname-doc"
source="http://downloads.sourceforge.net/project/sshguard/sshguard/sshguard-$pkgver/sshguard-$pkgver.tar.bz2
	sshguard.destination
	sshguard.filter
	sshguard.log
	sshguard.whitelist
	postfix.patch"

_builddir="$srcdir"/sshguard-$pkgver
prepare() {
	local i
	cd "$_builddir"
	update_config_sub || return 1
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--with-firewall=iptables \
		--with-iptables=/sbin/iptables || return 1
	make || return 1
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" install || return 1
	install -Dm644 "$srcdir"/sshguard.destination \
		"$pkgdir"/etc/syslog-ng/syslog-ng-destination.sshguard || return 1
	install -Dm644 "$srcdir"/sshguard.filter \
		"$pkgdir"/etc/syslog-ng/syslog-ng-filter.sshguard || return 1
	install -Dm644 "$srcdir"/sshguard.log \
		"$pkgdir"/etc/syslog-ng/syslog-ng-log.sshguard || return 1
	install -Dm644 "$srcdir"/sshguard.whitelist \
		"$pkgdir"/etc/sshguard/whitelist || return 1
}

md5sums="11b9f47f9051e25bdfe84a365c961ec1  sshguard-1.5.tar.bz2
c26efbd761df9dd57f7fbb00ccbb80fa  sshguard.destination
70eb72cd175923861cd3c711076b0d6a  sshguard.filter
213d849e842561e8406716a5eb07bae4  sshguard.log
f7c64f834056ad6926116aac14693d8e  sshguard.whitelist
a3aee1129f811cbd19c558b2bc6af146  postfix.patch"
sha256sums="b537f8765455fdf8424f87d4bd695e5b675b88e5d164865452137947093e7e19  sshguard-1.5.tar.bz2
444ec40ebd38185e37f3100e2a0cbf7f8dfe075ef66bf6f213de08a4aa888cb3  sshguard.destination
e2a83737fef25d8f6e6d125636b4cd315b179f72d3fa758c2bb2421949bccd73  sshguard.filter
98ec14fc3327e54bfbff8687881a9f8c84deecd8f7b073ce9d38f5190ef464d8  sshguard.log
d9434f83f8b3a071fb3db1e10a24ada20c4672af67f5ac729f8f0a9d28871c04  sshguard.whitelist
185a5567dda111b14229ea4a7ef924c3b7cb0bbc8acba74a60f40dc472b7c972  postfix.patch"
sha512sums="6d17abccd94af9e7fb04a54477ff5686caa64dc36e2f2cbc4a8cd7bc293923daf2fee87fa7f2e247eba1b310abe68549e652ab3224c2d19822d2e8a0306e49e6  sshguard-1.5.tar.bz2
6fc923efc58e322b62fc8d74bb0dc778dcca416726a422265dc9bdebb2c1f3dc2d795f781efa50a24015d46333ead29f9e576c21af308bba8867a3d681dd6c28  sshguard.destination
0a69764c6d89ea4e1cae2ac44ebc7b9371c9ce49f03aee45b0698d2cd22ab06774ed9f2618e86d1e6185b8b57e2dd450cfdac5f2d9ac7bc578c1e60f2499aeab  sshguard.filter
e7baf450ba5d16884ee66349a4a14aac3e3b8e06f977f785c2142f1897b47431a35d8398f37c6d19b78eaf89ccc635f3e3ea7a3f1fdcaf0c73655e685320fb1b  sshguard.log
2ba4b249bb38c8715d0c78e15fd4fc70e3b3b71f10ba63b220d538ae48baae2a0581e36fa7fc13b5a62142db7ec76889a28e93b2c2e7912128e0cb0a9d16b5ba  sshguard.whitelist
5dfbb013e5fe77e9fbc9643628c8bc495157c0db97778ee8fbddbe8a266e84257b541aaad7020104c0443a5e2bb3b826b077e936711580ae410573dcb9e4ed4b  postfix.patch"
