# Contributor: Jens Vehlhaber jv <jens@eisfair.org>
# Maintainer: Jens Vehlhaber jv <jens@eisfair.org>
pkgname=owfs
pkgver=3.1p0
pkgrel=0
pkgdesc="OWFS 1-Wire File System"
url="http://www.owfs.org"
arch="all"
license="GPLv2"
depends=""
depends_dev="linux-headers fuse-dev automake autoconf libtool libusb-dev libusb-compat-dev avahi-dev"
makedepends="$depends_dev"
install=""
subpackages="$pkgname-doc $pkgname-dev"
source="http://downloads.sourceforge.net/project/owfs/owfs/$pkgver/owfs-$pkgver.tar.gz
	libusb.patch
	owfs.initd
	owserver.initd
	owhttpd.initd
	"

_builddir="$srcdir"/owfs-$pkgver
prepare() {
	local i
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_builddir"
	./bootstrap
	./configure \
	        --prefix=/usr \
                --libexecdir=/usr/lib \
                --enable-usb \
                --enable-owfs \
                --disable-libow-perl \
                --disable-owphp \
                --disable-owpython \
                --disable-swig || return 1 #\
#                --disable-zero || return 1
	make || return 1
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" install || return 1
	install -D -m755 "$srcdir"/$pkgname.initd \
		${pkgdir}/etc/init.d/$pkgname || return 1
	install -D -m755 "$srcdir"/owserver.initd \
		${pkgdir}/etc/init.d/owserver || return 1
	install -D -m755 "$srcdir"/owhttpd.initd \
		${pkgdir}/etc/init.d/owhttpd || return 1
}

md5sums="3d8919af078ae8c9171e5713a1789195  owfs-3.1p0.tar.gz
d1bfe7af1a8b69c74278e15aaeaa2ec8  libusb.patch
885f468d996faa9af17354440a07ba9d  owfs.initd
756d0254a39eaab72c569842c526138f  owserver.initd
db72646ceb5d87c7c71f6bff5fceebf1  owhttpd.initd"
sha256sums="62fca1b3e908cd4515c9eb499bf2b05020bbbea4a5b73611ddc6f205adec7a54  owfs-3.1p0.tar.gz
4a067d784ea6725dfaff27739e2078a5fcfb23e82def6376bfe3085574f44bda  libusb.patch
c740e88e23f772bdb6c7dd1d40710cd8efeb5f2aa256b4463e5fbc027f2a60ad  owfs.initd
0ab04c6b8f648cac4f9bfdb54f7c909e01efa898d98bae2a0720f3c6be33ab08  owserver.initd
21171628c219a217dba090e4b263837039c104d4129ea3c05e62b173c8872d80  owhttpd.initd"
sha512sums="fc00e9d55be1cfd419df9f39c0aa3517f9c21a2ff4133d9feffc8e737bfa194eb4acba0a0fec65134cb86c8640c5341db638a74674e973025f203a989ca678ba  owfs-3.1p0.tar.gz
e5932a0caf5c79967182a73465e1f0bfe21de4e4e1298fbca7bdbc5ad2bd53f0ba880cfa2b2a8b2c09463f00724af3d0874308bfcb554691a76b761ad420b122  libusb.patch
2ad4370ac28d4a5acdc4e69fde08c96bf37d26547c11f85c92611d3538ed342b48a0f28c4833d28389c85d6bfd3c79e514b3106144ff44c5cf4a8a54325178d9  owfs.initd
0ceb92ffdc361307c4aa008976b84bac3081eb7700b5630d6c0d401f246643f4d4e8096d3fb37a88b4416ddfccc5d8f4b17bec52662c939c70d0a3b0a41bccbe  owserver.initd
a48dd97e2b43db18d525c07a91f525814438ebe3431289fd84c3229bf825ebec81b291c653c2a34d5fdae4527d6da65c74f9426423c2a203422afd1b3f7ce207  owhttpd.initd"
