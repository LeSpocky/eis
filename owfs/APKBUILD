# Contributor: Jens Vehlhaber jv <jens@eisfair.org>
# Maintainer: Jens Vehlhaber jv <jens@eisfair.org>
pkgname=owfs
pkgver=3.1p0
pkgrel=0
pkgdesc="OWFS 1-Wire File System"
url="http://www.owfs.org"
arch="all"
license="GPLv2"
depends=""
depends_dev="linux-headers fuse-dev automake autoconf libtool libusb-dev"
makedepends="$depends_dev"
install=""
subpackages="$pkgname-doc $pkgname-dev"
source="http://downloads.sourceforge.net/project/owfs/owfs/$pkgver/owfs-$pkgver.tar.gz
	libusb.patch
	owfs.initd
	owserver.initd
	owhttpd.initd
	"

_builddir="$srcdir"/owfs-$pkgver
prepare() {
	local i
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_builddir"
	export CPPFLAGS="-I/usr/include/libusb-1.0"
	./bootstrap
	./configure \
	        --prefix=/usr \
                --libexecdir=/usr/lib \
                --enable-usb \
                --enable-owfs \
                --disable-libow-perl \
                --disable-owphp \
                --disable-owpython \
                --disable-swig \
                --disable-zero  || return 1
	make || return 1
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" install || return 1
	install -D -m755 "$srcdir"/$pkgname.initd \
		${pkgdir}/etc/init.d/$pkgname || return 1
	install -D -m755 "$srcdir"/owserver.initd \
		${pkgdir}/etc/init.d/owserver || return 1
	install -D -m755 "$srcdir"/owhttpd.initd \
		${pkgdir}/etc/init.d/owhttpd || return 1
}

md5sums="3d8919af078ae8c9171e5713a1789195  owfs-3.1p0.tar.gz
4f0c9604045fbd338ba65a43d5301ff3  libusb.patch
808e67d60a64cf48c2cf6160fc01e83a  owfs.initd
d38c150a3c9b0e7a3656885203ddf6d9  owserver.initd
f24e8c6c1c43843b76761a3f35ef5851  owhttpd.initd"
sha256sums="62fca1b3e908cd4515c9eb499bf2b05020bbbea4a5b73611ddc6f205adec7a54  owfs-3.1p0.tar.gz
5b93b1fe9978622c83d8590a206a3276480f1fa0299a7bceff57c4ba0ea4930e  libusb.patch
d4d5bdfcde37a5dd9eb716e07aae52481a7a1341eba6ca11d885180e7d644425  owfs.initd
d4f91ba603fcc708ef5058bdcd586f5fdc507ffe2aa171fa3c7a67936108902f  owserver.initd
a7cd07afdd180888d38973f24c3f4042dfbb75dc259a3ee3515ce21dd71ed0db  owhttpd.initd"
sha512sums="fc00e9d55be1cfd419df9f39c0aa3517f9c21a2ff4133d9feffc8e737bfa194eb4acba0a0fec65134cb86c8640c5341db638a74674e973025f203a989ca678ba  owfs-3.1p0.tar.gz
0133a5a20cc37876dc8601bf395b5d8589b401864cc7d2d3df9264f2205dd829f63840e8297b43f138d03fd8be06f26f0424e3e7897cbb9474cbc7d986cb2516  libusb.patch
e60c188bbbfc5063a07e59e1edfb9f52418cfd47b28fdc08bd9ffdd36c60a038fbb162a2f0513c25214f139c336dcfd20771a1b5666638ed6cb26a6caf151ed0  owfs.initd
d0570b5d7201e74cc62872a1f51bbdc033af8669480b321349c3aa4d9f88206ac897a6cf97aed9a878691f4f138638308147f667c8595b3a557ff48423f9dc63  owserver.initd
827b7b77fb7b21686069f81e692f3170247df10a12be5d1c9b74c931eb6904cbe3c8b51da6ec4ff474c77d09a6eb257cb7c5a168bc9dea2bc96d9fe497058579  owhttpd.initd"
