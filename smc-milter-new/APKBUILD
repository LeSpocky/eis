# Contributor: Jens Vehlhaber jv <jens@eisfair.org>
# Maintainer: Jens Vehlhaber jv <jens@eisfair.org>
pkgname=smc-milter-new
pkgver=1.0.1
pkgrel=1
pkgdesc="Virus scanner milter for postfix"
url="http://www.eisfair.org"
arch="all"
license="GPLv2"
depends="altermime unrar zip ripmime"
_alpinerelease=`awk -F \. {'print $1$2'} /etc/alpine-release`
if [ "$_alpinerelease" -gt 31 ]
then
  depends_dev="libmilter-dev mariadb-dev"
else
  depends_dev="libmilter-dev mysql-dev"
fi

makedepends="$depends_dev"
install="$pkgname.pre-install $pkgname.post-install"
subpackages=""
source="
	smc-milter-new.initd
	smc-milter-new.confd
	"

_builddir="$srcdir/$pkgname"

prepare() {
	cp -r  ${startdir}/smc-milter-new "$srcdir/"
}

build() {
	cd "$_builddir"
	make -j1 -s || return 1
}

package() {
	cd "$_builddir"
	install -m755 -D "$_builddir"/$pkgname \
		"$pkgdir"/usr/sbin/$pkgname || return 1
	install -m755 -D "$_builddir"/${pkgname}-unzip.sh \
		"$pkgdir"/usr/bin/${pkgname}-unzip.sh || return 1
	install -m755 -D "$srcdir"/$pkgname.initd \
		"$pkgdir"/etc/init.d/$pkgname || return 1
	install -m640 -D "$srcdir"/$pkgname.confd \
		"$pkgdir"/etc/smc-milter-new/$pkgname.conf || return 1
}

md5sums="bb44847376e9a48a7728756c6652a34c  smc-milter-new.initd
03d8b426db5ff534de9b110a041b7ba8  smc-milter-new.confd"
sha256sums="10db87c4aad054feba4a2b91b31f5af1d0161b866e1966f9608e85699646f8a2  smc-milter-new.initd
004041e18693bd3cffc94e2cd53149883c1006f6e0a76a90ae1b15224d37e813  smc-milter-new.confd"
sha512sums="7ce7e9b7fd97fef9fb212948aedde61a93d91e75e144e6fc9fcb3ff264ba0f170b15ee055b66a8170101593b89e2d39072c653e0dbb97d7318f4313f6b06ac2a  smc-milter-new.initd
ef1a487ec79974bbc4bf0669466bc6d9ca76928cbf5ad3963862d6f30c25cdf06083b713cb2f3bdddb1a0dba7358c7f0f765ce547706ed92e5433c547a465f12  smc-milter-new.confd"
