# Contributor: jv <jens@eisfair.org>
# Maintainer: jv <jens@eisfair.org>
pkgname=syslog-ng
pkgver=2.1.4
pkgrel=0
pkgdesc="Syslog-NG"
url="http://www.balabit.com"
arch="all"
license="GNU"
depends="glib libeventlog"
depends_dev="glib-dev libeventlog-dev"
makedepends="$depends_dev"
install="$pkgname.pre-install $pkgname.post-install $pkgname.pre-deinstall $pkgname.pre-upgrade $pkgname.post-upgrade"
subpackages=""

source="http://www.balabit.com/downloads/files/syslog-ng/open-source-edition/${pkgver}/source/syslog-ng_${pkgver}.tar.gz
	syslog.logrotate
	syslog-ng.initd
	syslog-ng-destination.std
	syslog-ng-filter.std
	syslog-ng-log.std
	syslog-ng-options.std
	syslog-ng-source.std
	"

_builddir="$srcdir/${pkgname}-$pkgver"

prepare() {
	cd "$_builddir"
}

build() {
	cd "$_builddir"
	./configure --prefix=/usr \
	--sysconfdir=/etc/syslog-ng \
	--enable-ipv6 \
	--disable-sql \
	--disable-mongodb \
	--disable-json \
	|| return 1
	make || return 1
}

package() {
	cd "$_builddir"
	make -j1 DESTDIR=${pkgdir} install || return 1
	rm -rf ${pkgdir}/usr/share
	strip -R .note -R .comment ${pkgdir}/usr/bin/*
	strip -R .note -R .comment ${pkgdir}/usr/sbin/*
	install -D -m755 "$srcdir"/$pkgname.initd ${pkgdir}/etc/init.d/$pkgname || return 1
	install -D -m644 "$srcdir"/syslog-ng-destination.std ${pkgdir}/etc/syslog-ng/syslog-ng-destination.std || return 1
	install -D -m644 "$srcdir"/syslog-ng-filter.std ${pkgdir}/etc/syslog-ng/syslog-ng-filter.std || return 1
	install -D -m644 "$srcdir"/syslog-ng-log.std ${pkgdir}/etc/syslog-ng/syslog-ng-log.std || return 1
	install -D -m644 "$srcdir"/syslog-ng-options.std ${pkgdir}/etc/syslog-ng/syslog-ng-options.std || return 1
	install -D -m644 "$srcdir"/syslog-ng-source.std ${pkgdir}/etc/syslog-ng/syslog-ng-source.std || return 1
	install -D -m644 "$srcdir"/syslog.logrotate ${pkgdir}/etc/logrotate.d/syslog || return 1
}

md5sums="17c4c7725d2eab62b588395f1ed93f32  syslog-ng_2.1.4.tar.gz
8916d55f8213d2746e8c2a6a89c29d6c  syslog.logrotate
aca6b42ddecec1fbf7cebdf158496feb  syslog-ng.initd
f0b4a0b530e269c51bc63f5b9d817c9b  syslog-ng-destination.std
13654597e779e4ae072f93fe9a5647bc  syslog-ng-filter.std
1c7359cd41b2b752c163a930399d1d46  syslog-ng-log.std
a5dad3b437c5a2a7ce13d466abd1dce4  syslog-ng-options.std
b678eb6de7a3c42c8c956a6a4462f6c7  syslog-ng-source.std"
