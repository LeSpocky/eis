#!/bin/sh
#----------------------------------------------------------------------------
# del-menu - delete menu
#
# Creation:     09.12.2001  ms
#               02.11.2003  fm complete rewrite
# Last Update:  $Id: del-menu 24471 2010-06-10 21:14:01Z schlotze $
#
# Usage (for XML-menus)
# ---------------------------------
# del-menu menu-file sub-menu-file
# del-menu menu-file script-file
#
#          menu-file      filename relativ to menupath /var/install/menu
#
#          sub-menu-file  filename relativ to menupath /var/install/menu
#
#                         The line containing
#                             <menu file="sub-menu-file">
#                         is removed from the menu-file if the line exists.
#
#          script-file    filename relativ to /var/install/bin or absolute path
#
#                         The line containing
#                             <script file="script-file">
#                         is removed from the menu-file if the line exists.
#----------------------------------------------------------------------------
menu_path='/var/install/menu'

if [ -f "$menu_path/$1" ]
then
    # new syntax now matches add-menu
    menu_file=$1
    menu_cmd=$2
    # remove by command
    grep -vE "<(menu|script) file=\"$menu_cmd\">" $menu_path/$menu_file >/tmp/$menu_file.$$
    cp /tmp/$menu_file.$$ $menu_path/$menu_file     # don't mv, keep permissions
    rm -f /tmp/$menu_file.$$
fi
