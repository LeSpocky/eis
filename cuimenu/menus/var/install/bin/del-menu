#!/bin/sh
#-----------------------------------------------------------------------------
# /var/install/bin/del-menu - delete menu
# Copyright (c) 2001-2013 The Eisfair Team <team@eisfair.org>
#-----------------------------------------------------------------------------
# del-menu menu-file sub-menu-file
# del-menu menu-file script-file
#
#          menu-file      filename relativ to menupath /var/install/menu
#
#          sub-menu-file  filename relativ to menupath /var/install/menu
#                         The line containing
#                             <menu file="sub-menu-file">
#                         is removed from the menu-file if the line exists.
#
#          script-file    filename relativ to /var/install/bin or absolute path
#                         The line containing
#                             <script file="script-file">
#                         is removed from the menu-file if the line exists.
#----------------------------------------------------------------------------

if [ -f "/var/install/menu/$1" ] ; then
    # new syntax now matches add-menu
    menu_file=$1
    menu_cmd=$2
    # remove by command
    grep -vE "<(menu|script|doc.*) file=\"${menu_cmd}\">" /var/install/menu/${menu_file} >/tmp/$menu_file.$$
    cp -f /tmp/$menu_file.$$ /var/install/menu/${menu_file}     # don't mv, keep permissions
    rm -f /tmp/$menu_file.$$
fi

exit 0
