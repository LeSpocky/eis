# Contributor: eisfair team
# Maintainer: daniel@eisfair.org, jens@eisfair.org
pkgname=libcui-addon
pkgver=2.0.0
pkgrel=0
pkgdesc="Eisfair CUI basis lib addons"
url="http://www.eisfair.org"
arch="all"
license="GPL"
depends=""
depends_dev="coreutils ncurses-dev ncurses-widec-libs libiconv-dev flex libcui-dev"
makedepends="$depends_dev"
install=""
subpackages="$pkgname-libapk $pkgname-libmysql $pkgname-libpgsql $pkgname-libsys"
source=""

_builddir="$srcdir"

prepare() {
	local i
	cp -r addons "$srcdir/"
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd ${_builddir}/addons/libapk-addon
	make -j1 -s || return 1
	cd ${_builddir}/addons/libmysql-addon
	make -j1 -s || return 1
	cd ${_builddir}/addons/libpgsql-addon
	make -j1 -s || return 1
	cd ${_builddir}/addons/libsys-addon
	make -j1 -s || return 1
}

package() {
	mkdir -p ${pkgdir}/usr/lib/cui-addons
	cd ${_builddir}/addons/libapk-addon
	make DESTDIR=${pkgdir}/ install || return 1
	cd ${_builddir}/addons/libsys-addon
	make DESTDIR=${pkgdir}/ install || return 1
}

libapk() {
	pkgdesc="CUI lib addon for apk"
	cd ${_builddir}/addons/libapk-addon
	mkdir -p "$subpkgdir"/usr/lib/cui-addons/ || return 1
	mv "$pkgdir"/usr/lib/cui-addons/libapk* "$subpkgdir"/usr/lib/cui-addons/ || return 1
}

libmysql() {
	pkgdesc="CUI lib addon for MySQL database"
	depends="libcui>=$pkgver mysql-libs"
	cd ${_builddir}/addons/libmysql-addon
	mkdir -p "$subpkgdir"/usr/lib/cui-addons/ || return 1
#	make -j1 -s DESTDIR=${pkgdir}/ install || return 1
	make -j1 -s DESTDIR="$subpkgdir"/usr/lib/cui-addons/ || return 1
	echo "libmysql() done"
}

libpgsql() {
	pkgdesc="CUI lib addon for Postgresql database"
	depends="libcui>=$pkgver pgsql-libs"
	cd ${_builddir}/addons/libpgsql-addon
	mkdir -p "$subpkgdir"/usr/lib/cui-addons/ || return 1
#	make -j1 -s DESTDIR=${pkgdir}/ install || return 1
	make -j1 -s DESTDIR="$subpkgdir"/usr/lib/cui-addons/ || return 1
}

libsys() {
	pkgdesc="CUI lib addon for apk"
	cd ${_builddir}/addons/libsys-addon
	mkdir -p "$subpkgdir"/usr/lib/cui-addons/ || return 1
	mv "$pkgdir"/usr/lib/cui-addons/libsys* "$subpkgdir"/usr/lib/cui-addons/ || return 1
}
